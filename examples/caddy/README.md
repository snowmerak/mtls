# Caddy mTLS Configuration Example

This example shows how to configure Caddy to use mTLS certificates generated by the mtls tool.

## Prerequisites

1. Install Caddy: https://caddyserver.com/docs/install
2. Generate certificates using mtls tool:

```bash
# Generate CA
./mtls ca create --batch --cn "Example CA" --key-type rsa4096

# Generate server certificate
./mtls cert create --batch \
  --ca ./certs/ca \
  --cn "localhost" \
  --dns "localhost,127.0.0.1" \
  --ip "127.0.0.1" \
  --key-type rsa2048
```

## Directory Structure

```
examples/caddy/
├── Caddyfile           # Caddy configuration
├── README.md           # This file
└── run.sh              # Helper script to run Caddy
```

## Configuration

See `Caddyfile` for the mTLS configuration.

## Running

```bash
# From the mtls project root
cd examples/caddy

# Run Caddy with the configuration
./run.sh

# Or manually
caddy run --config Caddyfile
```

## Testing

```bash
# Test with curl (requires client certificate)
curl --cert ../../certs/servers/localhost/server-cert.pem \
     --key ../../certs/servers/localhost/server-key.pem \
     --cacert ../../certs/ca/ca-cert.pem \
     https://localhost:8443

# Test with Go client (see ../go-client)
cd ../go-client
go run main.go
```

## Configuration Details

The Caddyfile includes:

1. **TLS Certificate**: Server certificate and private key
2. **Client Authentication**: Requires and verifies client certificates
3. **Trusted CA**: CA certificate for verifying client certificates
4. **HTTPS Only**: Forces HTTPS on port 8443

## Security Notes

- Client certificates are required for all requests
- Invalid client certificates will be rejected
- Self-signed CA is trusted for client verification
- All connections are encrypted with TLS 1.2+
