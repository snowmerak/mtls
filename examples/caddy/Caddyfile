{
	# Global options
	auto_https off
	admin off
}

# mTLS enabled server
localhost:8443 {
	# Use the server certificate generated by mtls tool
	tls ../../certs/servers/localhost/server-cert.pem ../../certs/servers/localhost/server-key.pem {
		# Require and verify client certificates
		client_auth {
			mode require_and_verify
			# Trust the CA that signed the client certificates
			trusted_ca_cert_file ../../certs/ca/ca-cert.pem
		}
	}

	# Simple response for testing
	respond "Hello from mTLS Caddy server! Client certificate verified successfully." 200

	# Log requests
	log {
		output stdout
		format console
	}

	# You can add more routes here
	route /api/* {
		respond "API endpoint with mTLS protection" 200
	}

	route /health {
		respond "OK" 200
	}
}

# Alternative configuration with JSON API
# Uncomment if you want to serve a JSON response
# localhost:8443 {
# 	tls ../../certs/servers/localhost/server-cert.pem ../../certs/servers/localhost/server-key.pem {
# 		client_auth {
# 			mode require_and_verify
# 			trusted_ca_cert_file ../../certs/ca/ca-cert.pem
# 		}
# 	}
# 
# 	@api path /api/*
# 	handle @api {
# 		header Content-Type application/json
# 		respond `{"status": "success", "message": "mTLS verified", "client_verified": true}` 200
# 	}
# 
# 	handle {
# 		respond "mTLS Caddy Server" 200
# 	}
# }
