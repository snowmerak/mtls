# Node.js mTLS Server Example

A simple HTTPS server with mutual TLS authentication using Node.js built-in modules.

## Features

- ✅ Mutual TLS authentication
- ✅ Client certificate verification
- ✅ RESTful API endpoints
- ✅ No external dependencies (except nodemon for dev)
- ✅ Graceful shutdown

## Prerequisites

- Node.js 14+ (built-in `https` module)
- Certificates generated by the mtls CLI tool

## Setup

```bash
# Install dependencies (optional, only for development)
npm install

# Or use yarn
yarn install
```

## Running the Server

```bash
# Using npm
npm start

# Or directly with node
node server.js

# Development mode with auto-reload
npm run dev
```

The server will start on `https://localhost:8443`.

## Endpoints

- `GET /` - Main endpoint with client certificate info
- `GET /health` - Health check endpoint
- `GET /api/data` - Sample data endpoint
- `POST /api/echo` - Echo back the request body

## Testing

You can test the server using:

1. The Node.js client in `../node-client`
2. curl with certificates:
```bash
curl --cert ../../certs/servers/localhost/server-cert.pem \
     --key ../../certs/servers/localhost/server-key.pem \
     --cacert ../../certs/ca/ca-cert.pem \
     https://localhost:8443/
```

## Certificate Loading

The server loads:
- **Server certificate**: Used to identify the server to clients
- **Server private key**: Used to establish TLS connection
- **CA certificate**: Used to verify client certificates

```javascript
const options = {
  key: fs.readFileSync('server-key.pem'),
  cert: fs.readFileSync('server-cert.pem'),
  ca: fs.readFileSync('ca-cert.pem'),
  requestCert: true,              // Request client certificate
  rejectUnauthorized: true        // Reject unverified clients
};
```

## Configuration

Environment variables:
- `PORT` - Server port (default: 8443)

## Error Handling

The server will reject connections from:
- Clients without a certificate
- Clients with invalid certificates
- Clients with certificates not signed by the trusted CA

## Graceful Shutdown

Press `Ctrl+C` to gracefully shutdown the server. All active connections will be closed properly.
